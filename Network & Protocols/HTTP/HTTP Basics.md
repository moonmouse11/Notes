# HTTP Basics
***
_Протокол_ в информатике — это набор правил или язык, на котором программы могут общаться между собой и обмениваться данными (это не язык программирования, а язык обмена информацией). Протокол HTTP разрабатывался для обмена данными между браузером и веб-сервером, в первую очередь для того, чтобы браузер при просмотре сайта мог получить веб-страницу с сервера. Однако, он оказался пригодным и для других целей - например, для передачи данных между двумя программами, используя `REST API`, или для обмена данными между мобильным приложением и его сервером.
***
## Deliver Data In Network
Cеть соединяет между собой узлы (компьютеры или другие устройства). У каждого узла сети есть уникальный IP-адрес (IPv4 адреса выглядят как 4 числа, разделенных точками, вроде 192.168.15.21). Узлы могут отправлять друг другу _IP-пакеты_ данных, каждый пакет содержит адрес отправителя, адрес получателя и _полезную нагрузку_ (payload) - небольшое количество байт (обычно не более 1500 байт в одном пакете, и не более ~65500 байт, если передавать данные фрагментами в нескольких пакетах, на которые автоматически разбиваются большие пакеты).
Полезные данные кодируются в виде набора байт. Один байт - это группа из 8 _бит_, каждый из которых может принимать значение 0 или 1 (байты еще называют _октетами_, от слова «восемь»). Эти 8 бит могут образовать 28 = 256 разных комбинаций, которые обычно обозначают числами от 0 до 255 (или от 00 до FF в шестнадцатеричной системе счисления). Таким образом, содержимое пакета можно представить в виде набора чисел от 0 до 255. Программы, которые пересылают друг другу пакеты, сами решают, что именно обозначают те или иные значения и как кодируется информация в пакете. То есть любые данные, которые передаются по сети - текст, изображения, голос, видео, данные о положении и действиях игровых персонажей - все они кодируются с помощью набора байтов (а описание, что именно обозначают эти числа, как раз и называется протоколом).

Использовать для пересылки данных IP-пакеты напрямую не очень удобно, по таким причинам:

- в пакете указан IP-адрес узла-получателя, но не указано, какой из программ, запущенных на этом узле, предназначен пакет
- хотя сеть старается доставить пакет до получателя, пакет может потеряться в пути. Каждая программа сама должна как-то обнаруживать такие ситуации и отправлять пакет повторно
- размер пакета ограничен, и если программе надо передать большой объем данных, она должна сама разбить их на пакеты, пронумеровать их, переслать, а при получении - все тщательно проверить и собрать обратно

По этим причинам программы обычно используют дополнительные протоколы (договоренности, правила и стандарты) передачи данных, которые работают поверх IP-протокола. Есть два таких распространенных протокола:

- `UDP` - решает проблему указания программы-получателя, добавляя в IP-пакет _номер порта_ - число от 1 до 65535, которое указывает программу на компьютере-получателе, которой предназначен пакет. Он не решает проблему потерь пакетов и проблему ограничения размера пакета и потому используется там, где нужна минимальная задержка, но допустимы редкие потери данных. Например, в сетевых играх, при передаче голоса и звука в программах-мессенджерах.
- `TCP` - тоже добавляет в пакеты номер порта для указания программы-получателя. Еще он умеет передавать сколь угодно большие объемы данных, разбивая их на маленькие IP-пакеты при передаче и собирая обратно при получении, а также отслеживает потерявшиеся пакеты и пересылает их повторно. Протокол `TCP` позволяет двум программам установить друг с другом _TCP-соединение_, по которому они могут пересылать в обе стороны поток байт любой длины. Протокол `TCP` дает больше возможностей, чем `UDP`, но он требует немного больше времени на установление соединения, а при потере данных возникает небольшая задержка из-за необходимости повторной передачи. Он используются там, где надежность передачи данных важнее скорости их доставки.
Программы обычно используют один из этих двух протоколов, и сами решают, как они кодируют полезную информацию в виде байт. Способ кодирования информации называют _прикладным_ (придуманным для конкретной задачи) _протоколом_ (application protocol).

**Порт** - это число от 1 до 65535, которое указывает на программу, которой предназначен пакет. Когда программа хочет получать пакеты из сети, она "открывает" (резервирует, "слушает") порт с определенными номером. При поступлении пакета из сети операционная система смотрит на указанный в нем номер порта и передает его программе, "слушающей" этот порт, а если такой программы нет, то отбрасывает пакет или возвращает отправителю сообщение об ошибке. Одновременно один порт может "слушать" только одна программа.

Прикладные протоколы обычно делятся на два вида: _текстовые_ и _бинарные_ (двоичные). В текстовом протоколе информация сначала кодируется в виде текста, а затем этот текст кодируется в виде байт с помощью определенной [кодировки](https://github.com/codedokode/pasta/blob/master/cs/strings.md) (то есть каждому символу соответствует один или несколько байт). В бинарном протоколе данные кодируются напрямую в числа-байты. Бинарный протокол компактнее, требует меньше времени на кодирование/декодирование, он более эффективен, но текстовый протокол проще для понимания человеком, и с ним удобнее работать.

Приведу пример. Допустим, мы разрабатываем электронный термометр, который должен каждые N секунд пересылать по сети измеренную температуру на компьютер (на котором запущена программа, принимающая и сохраняющая эти данные). Допустим, что IP-адрес компьютера и номер порта программы, на который надо отправлять данные, заложены в термометр. Какой протокол мы можем придумать для решения этой задачи?

Из 2 транспортных протоколов - UDP и TCP - я выберу UDP, так как он проще устроен, и позволяет отправлять данные пакетами, не тратя время на установку и завершение соединения. Пакеты UDP могут иногда теряться, но это нам не критично, так как наш прибор шлет данные постоянно. Итак, каждые N секунд наш термометр будет отправлять один UDP-пакет, содержащий текущую температуру. Как мы ее закодируем в виде байт?

- если мы хотим использовать бинарный протокол, то мы можем сделать крошечный `UDP`-пакет, содержащий в качестве полезной нагрузки единственный байт, обозначающий температуру. Температура на улице может меняться (на планете Земля) примерно от -90 до +60 градусов, а в байте могут быть значения от 0 до 255, потому мы прибавим к температуре 90 и получим число от 0 до 150. Получатель, разумеется, должен не забыть после получения вычесть 90 из полученного значения. Также, это позволяет передавать только целые значения температуры, чтобы передавать дробные значения, придется использовать больше одного байта.
- если мы хотим использовать текстовый протокол, то мы просто представляем температуру в виде текста (например, `32`, `-20` или `-4.7`) и передаем UDP-пакет, где содержится этот текст в виде набора байт. Если использовать кодировку ASCII или utf-8, то цифры и знак минус там кодируются одним байтом и наша полезная нагрузка будет занимать 2-3 байта. Это больше, чем при использовании бинарного протокола, но зато эти данные проще прочесть человеку, если он захочет посмотреть на них.
***
