# Oh Shit, Git!
***
## Basic
Git сложен: легко всё проебать, и нереально понять как исправить. Документация Git - это финиш: чтобы найти решение, _тебе заранее надо знать название фишки_, которая вернет всё на место.
***
## Oh shit, I did something terribly wrong, please tell me git has a magic time machine!?!
``` bash
git reflog
# вы увидите список всего,
# что сделали в git, во всех ветках!
# у каждого элемента есть индекс HEAD@{индекс}
# найдите тот, перед которым всё сломалось
git reset HEAD@{index}
# волшебная машина времени
```
Используйте это чтобы вернуть случайно удалённые штуки, или убрать то чем Вы всё сломали, или восстановиться после неудачного слияния, или просто вернуться туда, когда всё работало. Я ОЧЕНЬ ЧАСТО использую `reflog`. Снимаю шляпу перед теми, кто предложил добавить это.
***
## Oh shit, I committed and immediately realized I need to make one small change!
``` bash
# сделайте своё изменение
git add . # или добавьте файлы по отдельности
git commit --amend --no-edit
# теперь ваш последний коммит содержит это изменение!
# ПРЕДУПРЕЖДЕНИЕ: никогда не меняйте опубликованные коммиты!
```
Обычно я это использую когда коммичу, потом запускаю тесты/сканеры... и блин, я не поставил пробел после знака равно. Также можно сделать изменения в новом коммите и использовать `rebase -i` чтобы склеить оба коммита вместе, но так в миллион раз быстрее.
**_Предупреждение: никогда не изменяйте коммиты, отправленные в публичную ветку! Изменяйте только коммиты в вашей локальной ветке, иначе Вам не поздоровится._**
***
## Oh shit, I need to change the message on my last commit!
``` bash
git commit --amend
# follow prompts to change the commit message
```
Ёбаные требования по наименованию.
***
## Oh shit, I accidentally committed something to master that should have been on a brand new branch!
``` bash
# создаст новую ветку из текущего состояния мастера
git branch [branch_name]
# удалит последний коммит из мастера
git reset HEAD~ --hard
git checkout какое-то-имя-новой-ветки
# ваш коммит теперь живёт в этой ветке :)
```
**Это не будет работать, если вы уже отправили коммит в удалённую ветку, и если вы пробовали сделать это как-то по-другому, может помочь `git reset HEAD@{количество-коммитов-назад}` вместо `HEAD~`.**
Ёбушки-воробушки. Так же многие люди предлагали сделать то же самое, но короче. Спасибо всем!
***
## Oh shit, I accidentally committed to the wrong branch!
``` bash
# отменяет последний коммит, но оставляет изменения доступными
git reset HEAD~ --soft
git stash
# переключиться на нужную ветку
git checkout [branch_name]
git stash pop
git add . # или добавьте отдельные файлы
git commit -m "ваше сообщение здесь"
# теперь ваши изменения на нужной ветке
```
Многие люди предлагали использовать `cherry-pick` в такой ситуации, так что выбирайте, то что вам больше нравится!
``` bash
git checkout [branch_name]
# скопировать последний коммит из мастера
git cherry-pick master
# удалить из мастера
git checkout master
git reset HEAD~ --hard
```
***
## Oh shit, I tried to run a diff but nothing happened?!
Если вы уверены, что изменили файлы, но `diff` пуст, возможно вы индексировали изменения (`add`) и нужно добавить специальный флаг.
``` bash
git diff --staged
```
***
## Oh shit, I need to undo a commit from like 5 commits ago!
``` bash
# найдите коммит, который нужно отменить
git log
# используйте стрелочки, чтобы прокрутить историю
# сохраните хеш нужного коммита
git revert [saved_hash]
# git создаст новый коммит, отменяющий выбранный
# отредактируйте сообщений коммита
# или просто сохраните
```
Вам не нужно откатываться назад и копипастить старый файл в существующий! Если вы закоммитили хрень, её можно убрать с `revert`.
Также можно отменить только один файл вместо целого коммита! Но конечно, (как всегда у git это совершенно другой набор чёртовых команд...
***
## Oh shit, I need to undo my changes to a file!
``` bash
# найти хеш коммита, до которого нужно откатиться
git log
# используйте стрелочки, чтобы прокрутить историю
# сохраните хеш нужного коммита
git checkout [saved_hash] -- path_to_file
# старая версия файла окажется в вашем индексе
git commit -m "Ого, теперь не придётся копипастить, чтобы отменить изменения!"
```
Когда до меня это дошло, это было **ОХУЕННО**. Если серьезно, то схуяли `checkout --` лучший способ отменять изменения?
***
## Fuck this noise, I give up.
``` bash
cd ..
sudo rm -r fucking-repository-git
git clone https://some.github.url/fucking-repository-git.git
cd fucking-repository-git
```
Вообще говоря, если ваша ветка настооолько загажена, что нужно вернуться к удалённому состоянию в "git-корректном стиле" попробуйте это, но это необратимо!
``` bash
# получить последнее состояние origin
git fetch origin
git checkout master
git reset --hard origin/master
# удалить неиндексированные файлы
git clean -d --force
# повторить checkout/reset/clean для каждой испорченной ветки
```
***
